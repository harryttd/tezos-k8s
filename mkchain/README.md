# mkchain

Helper program to generate values for the Tezos chain Helm chart

## Quickstart

This assumes you have [minikube](https://minikube.sigs.k8s.io/docs/), [helm](https://helm.sh/), `python3`, and `git` installed. If you don't have docker installed, or you do but don't want to use your local install, configure your shell environment to use minikubeâ€™s Docker daemon:
```shell
eval $(minikube docker-env)
```

### Install mkchain

```shell
git clone https://github.com/tqtezos/tezos-k8s.git
cd tezos-k8s
python3 -m venv .venv
source .venv/bin/activate
pip install mkchain
```

Set [unbuffered IO](https://docs.python.org/3.6/using/cmdline.html#envvar-PYTHONUNBUFFERED) for python:

```shell
PYTHONUNBUFFERED=x
```

### Create Tezos Chain

```shell
CHAIN_NAME=my-chain
mkchain $CHAIN_NAME

helm install $CHAIN_NAME charts/tezos \
--values <CURRENT WORKING DIRECTORY>/${CHAIN_NAME}_values.yaml \
--namespace tqtezos --create-namespace
```

## Generate Helm Values

Your chain is uniquely defined by a set of values such as bootstrap account keys, chain id, timestamp...

Create these values:

```shell
mkchain $CHAIN_NAME
```

This command will generate two 2 yaml files in your current working directory. `<$CHAIN_NAME>_values.yaml` and `<$CHAIN_NAME>_invite_values.yaml`.

### mkchain parameters

You can modify these parameters by:

- passing CLI parameters to `mkchain`
- directly modifying the values yaml file generated by `mkchain`
- passing arguments to [`helm install`](https://helm.sh/docs/helm/helm_install/) or [`helm upgrade`](https://helm.sh/docs/helm/helm_upgrade/) commands using the `--set` flag, which will selectively override the current yaml values

| YAML Key                      | mkchain argument   | Description                                        | Default                |
| ----------------------------- | ------------------ | -------------------------------------------------- | ---------------------- |
| bootstrap_peer                | --bootstrap-peer   | Peer ip to connect to                              |                        |
| container_images.docker_image | --docker-image     | Version of the Tezos docker image                  | tezos/tezos:v7-release |
| number_of_nodes               | --number-of-nodes  | Number of peers in the cluster                     | 1                      |
| rpc_auth                      | --rpc-auth         | Whether or not an RPC auth backend will be spun up | False                  |
| zerotier_network              | --zerotier-network | Zerotier network id for external chain access      |                        |
| zerotier_token                | --zerotier-token   | Zerotier token for external chain access           |                        |
